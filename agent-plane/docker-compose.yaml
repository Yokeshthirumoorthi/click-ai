services:

  # ─── Analysis Platform ─────────────────────────────────────────
  platform:
    build:
      context: .
    container_name: click-ai-platform
    ports:
      - "3000:8000"
    environment:
      CH_HOST: ${CH_HOST:-clickhouse}
      CH_PORT: ${CH_PORT:-8123}
      CH_USER: ${CH_USER:-admin}
      CH_PASSWORD: ${CH_PASSWORD:-clickhouse123}
      CH_DATABASE: ${CH_DATABASE:-otel}
      OPENROUTER_API_KEY: "${OPENROUTER_API_KEY}"
      OPENROUTER_BASE_URL: ${OPENROUTER_BASE_URL:-https://openrouter.ai/api/v1}
      LLM_MODEL: ${LLM_MODEL:-anthropic/claude-sonnet-4}
      AUTH_SECRET: ${AUTH_SECRET:-change-me-in-production}
      AUTH_USERNAME: ${AUTH_USERNAME:-admin}
      AUTH_PASSWORD: ${AUTH_PASSWORD:-admin}
      S3_ENDPOINT: ${S3_ENDPOINT:-http://minio:9000}
      S3_ACCESS_KEY: ${S3_ACCESS_KEY:-minioadmin}
      S3_SECRET_KEY: ${S3_SECRET_KEY:-minioadmin}
      S3_BACKUP_BUCKET: ${S3_BACKUP_BUCKET:-ch-backups}
      S3_REGION: ${S3_REGION:-us-east-1}
    volumes:
      - session-data:/app/data/sessions
    depends_on:
      clickhouse:
        condition: service_healthy
    profiles:
      - agent

volumes:
  session-data:
